* Eric Drechsel's NixOS configs
  
This repo contains configurations for my [NixOS](https://nixos.org/) systems. I've been watching NixOS develop from ArchLand for several years, and have decided it's time to make the jump! 

* Sprints
  - [ ] Move tasks below into here
** M1: Scale the first NixOS "Learning cliff"
*** DONE [#A] pidrive nixos bootstrap
    CLOSED: [2021-02-07 Sun 20:03]
**** DONE [#A] Figure out why ssh pinentry fails to show
     CLOSED: [2021-02-07 Sun 20:04]
***** It is on the tty behind sway. This is annoying.
      I figured it out!!!
      What works:
      - systemctl --user restart gpg-agent
      - gpg-connect-agent updatestartuptty /bye
      Maybe it's not showing graphically because it doesn't have the env vars
      `systemctl --user show-environment`
     
     [[https://wiki.archlinux.org/index.php/environment_variables][Environment variables - ArchWiki]] 
     [[https://wiki.archlinux.org/index.php/Systemd/User#Environment_variables][systemd/User - ArchWiki]] 
    [[https://wiki.gnome.org/Initiatives/Wayland/SessionStart][Initiatives/Wayland/SessionStart - GNOME Wiki!]] 
*** DONE SSH agent forwarding
    CLOSED: [2021-02-09 Tue 12:02]
    So I can git clone, ssh out, etc
    Is there some nice way to handle key distribution? I think this is a problem for another year.
*** TODO [#A] bootstrap cobaltsoul
    https://nixos.wiki/wiki/NixOS_on_ARM/ODROID-HC1
    Let's try with unstable kernel, maybe the same uboot patches that helped the pi3 will help.
*** TODO Flakes
**** DONE flakes-enabled nix
     CLOSED: [2021-02-06 Sat 21:02]
    https://www.tweag.io/blog/2020-07-31-nixos-flakes/
**** DONE Add flake.nix for pidrive
     CLOSED: [2021-02-09 Tue 11:39]
**** DONE Single top-level flake with multiple outputs
     CLOSED: [2021-02-09 Tue 20:02]
**** TODO Replace nixpkgs channels with flakes
*** Bootstrap VPS: publicist
*** Wordpress site on publicist
** M2: Network
*** TODO Research where to store secrets
    - what does the community do (davidak etc)?
    - Password store integration?
    - git-crypt
    - https://christine.website/blog/nixos-encrypted-secrets-2021-01-20
    - https://github.com/mozilla/sops ([[https://github.com/colemickens/nixcfg#secrets][colemickens uses]])
    - https://github.com/Mic92/sops-nix
    - https://www.reddit.com/r/NixOS/comments/j6nqbe/declarative_secrets/
    https://discourse.nixos.org/t/how-to-setup-user-ssh-keys/5745/6
*** TODO Wireguard
*** TODO Syncthing
*** 
** M3: prove out my shell env
*** TODO Bootstrap a test VM on chip
*** TODO homemanager
    - sway
    - spacemacs
*** TODO sway stuff
    use colemickens' overlay prob
    - waybar
    - wofi
    - wlr-randr
    - kanshi
*** TODO Sway config
    - use the wayland overlay
    - look at op configs (cole?)
    https://nixos.wiki/wiki/Sway
    https://github.com/colemickens/nixpkgs-wayland
*** TODO capslock is escape, switch left alt and left meta
*** TODO home-manager
    https://github.com/nix-community/home-manager 
*** Emacs
**** WAITING nativecomp
     [gccemacs packaging Â· Issue #87400 Â· NixOS/nixpkgs](https://github.com/NixOS/nixpkgs/issues/87400)
**** TODO doom-emacs
     https://github.com/vlaci/nix-doom-emacs
     https://github.com/hlissner/doom-emacs 
     https://github.com/hlissner/doom-emacs/blob/develop/docs/faq.org
     https://github.com/hlissner/doom-emacs/blob/develop/modules/config/default/+evil-bindings.el
**** org agenda / refile and projectile
     [[https://shreyas.ragavan.co/post/8f702ce2-8bb7-40a3-b44b-a47222c02909/][Juggling multiple projects and leveraging org-projectile | Shreyas Ragavan]]
     https://develop.spacemacs.org/layers/+emacs/org/README.html#project-support
** TODO Figure out how to bootstrap hostname with flake.nix
   nixos-rebuild test --flake #pidrive
   is there any way to set hostname based on nixosSystem key?
** GPG/SSH Agent
   https://github.com/colemickens/nixcfg/blob/main/mixins/gpg-agent.nix

* Someday/Maybe
* Features
** TODO [#A] New wordpress host for Lauren
** TODO [#B] cobaltsoul Mac OS backup target
   Research: Time machine or something else? 
   IMO Time machine is dead now that apple isn't selling dedicated hw ðŸ’©

* Resources
** Nix / NixOS basics
   https://nixos.org/guides/nix-pills/functions-and-imports.html
   https://nixos.wiki/index.php?title=Cheatsheet&useskin=vector
** Configs
    https://codeberg.org/davidak/nixos-config (overall structure)
    https://github.com/colemickens/nixcfg
    https://github.com/NixOS/nixos-hardware

** Flakes
   seem to be the future. Need to understand them better
    https://nixos.wiki/wiki/Flakes
    [[https://blog.ysndr.de/posts/internals/2021-01-01-flake-ification/][y|sndr - Building with Nix Flakes for, eh .. reasons!]] 
    https://github.com/nrdxp/nixflk
    https://github.com/NixOS/nixos-hardware#using-nix-flakes-support
    [~kaction/config#1: Switch repository to Nix Flakes â€” sourcehut todo](https://todo.sr.ht/~kaction/config/1)
    https://discourse.nixos.org/t/to-flake-or-not-to-flake/10047/4
*** Qs
**** Different nixpkgs per package output (nixosSystem)?
     https://discourse.nixos.org/t/hostname-based-flake-lock/10578
**** And Homemanager
**** Howto boot
** Home Manager
   https://www.reddit.com/r/NixOS/comments/j3wvun/what_role_does_home_manager_fill_that_nixos_cant/
   https://www.google.com/search?q=nix%20home-manager%20and%20flakes
   https://www.reddit.com/r/NixOS/comments/iogoox/homemanager_with_flakes_on_non_nixos_system/

** Conference Talks
   [[https://www.youtube.com/c/NixCon/videos][NixCon - YouTube]] 

** Direnv
   https://github.com/nix-community/nix-direnv

* Profiles
** Desktop
*** TODO Blueman
* Machines
** DONE pidrive
   CLOSED: [2021-02-11 Thu 15:11]
** TODO silversurfer
*** DONE Look up model info
*** DONE Research issue with 64bit
*** TODO Make 32bit min usb
*** TODO Install 32bit
*** TODO Make 64bit usb
*** TODO Install 64bit
*** TODO ? Add to https://github.com/NixOS/nixos-hardware/tree/master/apple/macbook-pro

** TODO chip
** DEFERRED coboltsoul and bookmobile (armv7 builds are a lot more work)
* Services
* Network
** TODO Wireguard
*** Nixos and others interop.. how to exchange keys? Shared secret store?
** TODO Monitoring
   https://www.reddit.com/r/NixOS/comments/l84udd/what_do_you_use_for_monitoring/
   https://christine.website/blog/prometheus-grafana-loki-nixos-2020-11-20
   https://github.com/NixOS/nixpkgs/tree/master/nixos/modules/services/monitoring
** Alerts
*** TODO Basic
*** TODO Services down (mutual watch)
